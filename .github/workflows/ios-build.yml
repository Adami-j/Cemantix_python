name: Build iOS App

on:
  workflow_dispatch:
  push:
    branches:
      - android 

jobs:
  build-ios:
    runs-on: macos-latest
    environment: Production

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # --- 1. Installation des dépendances ---
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
      
      - name: Install JavaScript Dependencies
        # CLÉ DE LA CORRECTION : Exécution du npm install dans le sous-dossier 'android'
        run: npm install
        working-directory: android 
        
      # --- 2. Préparation du projet iOS ---
      - name: Add iOS Platform
        # Ajout de la plateforme iOS depuis le bon dossier
        run: npx cap add ios || true 
        working-directory: android

      - name: Copy and Sync Web Assets
        # Exécution du script de synchronisation depuis le bon dossier
        run: npm run sync-ios
        working-directory: android
        
      # --- 3. Configuration et Compilation native (à compléter) ---
      # ... (Reste de la configuration Fastlane/Build) ...